<!DOCTYPE html>
<html>
<head>
<title>Webhook Log</title>
<style>
body{background:#0a0a0a;color:#00ff00;font-family:monospace;padding:40px;line-height:1.6;}
h1{margin-bottom:10px;}
.subtitle{color:#666;margin-bottom:30px;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{text-align:left;padding:8px 12px;border-bottom:1px solid #1a1a1a;}
th{color:#00aa00;font-weight:normal;}
.timestamp{color:#666;}
.method{color:#00ffff;}
.payload{color:#888;font-size:12px;max-width:400px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.empty{color:#666;padding:40px;text-align:center;}
.refresh{color:#00ff00;cursor:pointer;text-decoration:underline;}
</style>
</head>
<body>
    <!-- Signal Contact Badge -->
    <a href="https://signal.me/#eu/safesapcrtx.26" target="_blank" rel="noopener"
       onclick="return openSignal(event)"
       style="position: fixed; top: 60px; right: 8px; z-index: 9999;
              background: #3a76f0; color: white; padding: 6px 10px;
              border-radius: 8px; text-decoration: none; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
              font-size: 11px; font-weight: 600; display: flex; align-items: center; gap: 6px;
              box-shadow: 0 2px 8px rgba(0,0,0,0.2); transition: transform 0.2s;"
       onmouseover="this.style.transform='scale(1.05)'"
       onmouseout="this.style.transform='scale(1)'">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
            <path d="M12 2C6.48 2 2 6.48 2 12c0 1.85.5 3.58 1.37 5.07L2 22l4.93-1.37C8.42 21.5 10.15 22 12 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm0 18c-1.7 0-3.28-.46-4.65-1.25l-.33-.2-3.42.95.95-3.42-.2-.33C3.46 15.28 3 13.7 3 12c0-4.97 4.03-9 9-9s9 4.03 9 9-4.03 9-9 9z"/>
        </svg>
        Signal: safesapcrtx.26
    </a>

<h1>Webhook Log</h1>
<p class="subtitle">Public visibility. All callbacks logged anonymously. <span class="refresh" onclick="loadLogs()">Refresh</span></p>

<table>
<thead>
<tr><th>Timestamp</th><th>Method</th><th>Path</th><th>Payload</th></tr>
</thead>
<tbody id="log-body">
<tr><td colspan="4" class="empty">Loading...</td></tr>
</tbody>
</table>

<p style="margin-top:40px;">üè∞</p>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl = 'https://uynnupaoafbwouvgcedj.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5bm51cGFvYWZid291dmdjZWRqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyNTU2NzQsImV4cCI6MjA2NDgzMTY3NH0.a1PrSMUxCOjCLCHjUMjGefQf-DNhm0WlXGw8VVTZLo8';

async function loadLogs() {
  const tbody = document.getElementById('log-body');
  tbody.innerHTML = '<tr><td colspan="4" class="empty">Loading...</td></tr>';

  try {
    const { createClient } = supabase;
    const client = createClient(supabaseUrl, supabaseKey);

    const { data, error } = await client
      .from('webhook_log')
      .select('timestamp, method, path, payload')
      .order('timestamp', { ascending: false })
      .limit(50);

    if (error) throw error;

    if (!data || data.length === 0) {
      tbody.innerHTML = '<tr><td colspan="4" class="empty">No webhook callbacks logged yet.</td></tr>';
      return;
    }

    tbody.innerHTML = data.map(row => `
      <tr>
        <td class="timestamp">${new Date(row.timestamp).toLocaleString()}</td>
        <td class="method">${row.method || '-'}</td>
        <td>${row.path || '-'}</td>
        <td class="payload">${row.payload || '-'}</td>
      </tr>
    `).join('');

  } catch (err) {
    console.error('Error:', err);
    tbody.innerHTML = '<tr><td colspan="4" class="empty">Error loading logs.</td></tr>';
  }
}

loadLogs();
setInterval(loadLogs, 30000);
</script>

    <script>
    function openSignal(e) {
        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            e.preventDefault();
            var appUrl = 'sgnl://signal.me/#eu/safesapcrtx.26';
            var webUrl = 'https://signal.me/#eu/safesapcrtx.26';
            window.location.href = appUrl;
            setTimeout(function() { window.location.href = webUrl; }, 1500);
            return false;
        }
        return true;
    }
    </script>
</body>
</html>
