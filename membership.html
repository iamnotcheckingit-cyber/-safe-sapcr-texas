<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5GFPNCB5');</script>
    <!-- End Google Tag Manager -->

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PKQBVKKHB8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-PKQBVKKHB8');
    </script>

    <title>Join SAFE SAPCR Texas | Member Login | Family Law Reform Advocacy</title>
    <meta name="description" content="Join SAFE SAPCR Texas to support family law reform. Sign up to get legislative updates, advocacy resources, and connect with other advocates fighting SAPCR fraud.">
    <meta name="keywords" content="SAFE SAPCR Texas membership, Texas family law advocacy, SAPCR reform advocacy, join family law movement, Texas custody reform, protect parents rights Texas, family court reform membership, legislative advocacy Texas">
    <link rel="canonical" href="https://safesapcrtx.org/membership">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://safesapcrtx.org/membership">
    <meta property="og:title" content="Join SAFE SAPCR Texas | Advocacy Membership">
    <meta property="og:description" content="Join the movement to protect Texas families from extrinsic fraud and abuse of process. Get legislative updates and advocacy resources.">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="SAFE SAPCR Texas">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://safesapcrtx.org/membership">
    <meta name="twitter:title" content="Join SAFE SAPCR Texas | Advocacy Membership">
    <meta name="twitter:description" content="Join the movement to protect Texas families from extrinsic fraud and abuse of process.">

    <!-- Geo Tags -->
    <meta name="geo.region" content="US-TX">
    <meta name="geo.placename" content="Texas">
    <!-- Structured Data - WebPage -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Join SAFE SAPCR Texas - Become a Member",
        "description": "Join SAFE SAPCR Texas to support family law reform and protect parents from extrinsic fraud and abuse of process in custody cases.",
        "url": "https://safesapcrtx.org/membership",
        "isPartOf": {
            "@type": "WebSite",
            "name": "SAFE SAPCR Texas",
            "url": "https://safesapcrtx.org"
        }
    }
    </script>

    <link rel="stylesheet" href="style.css">

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://uynnupaoafbwouvgcedj.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_a5-eDlQRhKJkiuDPV0R0pA_TwLXKDyn';
    </script>

    <!-- Auth0 SPA SDK -->
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
    <script>
        // Auth0 Configuration
        const AUTH0_DOMAIN = 'dev-rdmu3fhvd2ymxyq4.us.auth0.com';
        const AUTH0_CLIENT_ID = 'EtWaElBhwQtSRmUVVEDPT4UH8UfzkUX3';
        const AUTH0_REDIRECT_URI = window.location.origin + '/membership';
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        .membership-hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 8rem 2rem 4rem;
            text-align: center;
        }
        .membership-hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        .membership-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }
        .signup-section {
            padding: 4rem 2rem;
            max-width: 600px;
            margin: 0 auto;
        }
        .signup-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 2.5rem;
        }
        .signup-container h2 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 0.5rem;
        }
        .signup-container .subtitle {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 2rem;
        }
        .signup-form .form-group {
            margin-bottom: 1.25rem;
        }
        .signup-form label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
        }
        .signup-form input,
        .signup-form select,
        .signup-form textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        .signup-form input:focus,
        .signup-form select:focus,
        .signup-form textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        .signup-form .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        .signup-form .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }
        .signup-form .checkbox-group input {
            width: auto;
            margin-top: 0.25rem;
        }
        .signup-form .checkbox-group label {
            font-weight: normal;
            margin-bottom: 0;
        }
        .signup-form .btn-submit {
            width: 100%;
            padding: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
            margin-top: 1rem;
        }
        .signup-form .btn-submit:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }
        .benefits-section {
            background: var(--bg-alt);
            padding: 4rem 2rem;
        }
        .benefits-section h2 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 2rem;
        }
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            max-width: 1000px;
            margin: 0 auto;
        }
        .benefit-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }
        .benefit-card h3 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        .benefit-card p {
            color: var(--text-light);
            margin: 0;
        }
        .success-message {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        .success-message.show {
            display: block;
        }
        .success-message h2 {
            color: var(--primary);
            margin-bottom: 1rem;
        }
        .success-message p {
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }
        .success-message .checkmark {
            width: 80px;
            height: 80px;
            background: #d4edda;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2.5rem;
            color: #155724;
        }
        /* SSO Login Styles */
        .sso-section {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }
        .sso-section h3 {
            text-align: center;
            color: var(--text);
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        .sso-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .sso-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 6px;
            background: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .sso-btn:hover {
            border-color: var(--primary);
            background: #f8f9fa;
        }
        .sso-btn svg {
            width: 20px;
            height: 20px;
        }
        .sso-btn.google {
            color: #333;
        }
        .sso-btn.microsoft {
            color: #333;
        }
        .sso-btn.apple {
            color: #333;
        }
        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 1.5rem 0;
            color: var(--text-light);
            font-size: 0.9rem;
        }
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--border);
        }
        .divider::before {
            margin-right: 1rem;
        }
        .divider::after {
            margin-left: 1rem;
        }
        .logged-in-view {
            text-align: center;
            display: none;
        }
        .logged-in-view.show {
            display: block;
        }
        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }
        .user-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        .btn-logout {
            margin-top: 1rem;
            padding: 0.75rem 2rem;
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-logout:hover {
            background: var(--primary);
            color: white;
        }
        @media (max-width: 600px) {
            .membership-hero h1 {
                font-size: 1.8rem;
            }
            .signup-container {
                padding: 1.5rem;
            }
            .signup-form .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="/" class="logo">
                <picture><source srcset="/images/safe-sapcr-logo.webp" type="image/webp"><img src="/images/safe-sapcr-logo.png" alt="SAFE SAPCR Logo" class="logo-img" width="45" height="45"></picture>
                <span class="logo-text">SAFE SAPCR<span class="tx">TX</span></span>
            </a>
            <div class="menu-toggle" id="menuToggle" role="button" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="navMenu" tabindex="0">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul id="navMenu">
                <li><a href="/#problem">The Problem</a></li>
                <li><a href="/legislation">Legislation</a></li>
                <li><a href="/legislators">Legislators</a></li>
                <li><a href="/case-study">Case Study</a></li>
                <li><a href="/resources">Resources</a></li>
                <li><a href="/petition">Petition</a></li>
                <li><a href="/membership">Join</a></li>
            </ul>
        </nav>
    </header>

    <section class="membership-hero">
        <h1>Join the Movement</h1>
        <p>Become a member of SAFE SAPCR Texas and help us fight for family law reform. Together, we can protect parents and children from fraudulent default judgments.</p>
    </section>

    <section class="signup-section">
        <div class="signup-container">
            <!-- Logged In View -->
            <div class="logged-in-view" id="loggedInView">
                <div class="user-avatar" id="userAvatar">
                    <span id="userInitials"></span>
                </div>
                <h2>Welcome, <span id="userName"></span>!</h2>
                <p>You're signed in as <strong id="userEmail"></strong></p>
                <p style="color: var(--text-light); margin-top: 1rem;">Thank you for being part of SAFE SAPCR Texas. You'll receive legislative updates and action alerts.</p>
                <a href="/legislators" class="btn btn-primary" style="display: inline-block; padding: 1rem 2rem; background: var(--primary); color: white; text-decoration: none; border-radius: 6px; font-weight: 600; margin-top: 1rem;">Contact Your Legislator</a>
                <br>
                <button class="btn-logout" id="logoutBtn">Sign Out</button>
            </div>

            <!-- Signup Form -->
            <div id="signupFormContainer">
                <h2>Become a Member</h2>
                <p class="subtitle">Join our advocacy network and stay informed</p>

                <!-- SSO Login Section -->
                <div class="sso-section" id="ssoSection">
                    <h3>Sign in with</h3>
                    <div class="sso-buttons">
                        <button type="button" class="sso-btn google" id="googleLogin">
                            <svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                            Continue with Google
                        </button>
                        <button type="button" class="sso-btn microsoft" id="microsoftLogin">
                            <svg viewBox="0 0 24 24"><path fill="#F25022" d="M1 1h10v10H1z"/><path fill="#00A4EF" d="M1 13h10v10H1z"/><path fill="#7FBA00" d="M13 1h10v10H13z"/><path fill="#FFB900" d="M13 13h10v10H13z"/></svg>
                            Continue with Microsoft
                        </button>
                        <button type="button" class="sso-btn apple" id="appleLogin">
                            <svg viewBox="0 0 24 24"><path fill="#000" d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.53 4.08zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/></svg>
                            Continue with Apple
                        </button>
                    </div>
                    <div class="divider">or sign up with email</div>
                </div>

                <form name="membership" method="POST" data-netlify="true" netlify-honeypot="bot-field" class="signup-form" id="signupForm" action="/membership">
                    <p style="display:none;">
                        <label>Don't fill this out: <input name="bot-field"></label>
                    </p>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name *</label>
                            <input type="text" id="firstName" name="firstName" required placeholder="John">
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name *</label>
                            <input type="text" id="lastName" name="lastName" required placeholder="Doe">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="email">Email Address *</label>
                        <input type="email" id="email" name="email" required placeholder="you@example.com">
                    </div>

                    <div class="form-group">
                        <label for="phone">Phone Number (optional)</label>
                        <input type="tel" id="phone" name="phone" placeholder="(555) 123-4567">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">City *</label>
                            <input type="text" id="city" name="city" required placeholder="Houston">
                        </div>
                        <div class="form-group">
                            <label for="county">County</label>
                            <input type="text" id="county" name="county" placeholder="Harris">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="involvement">How would you like to be involved?</label>
                        <select id="involvement" name="involvement">
                            <option value="">Select an option...</option>
                            <option value="updates">Just keep me updated</option>
                            <option value="contact-legislators">I'll contact my legislators</option>
                            <option value="share-story">I want to share my story</option>
                            <option value="volunteer">I want to volunteer</option>
                            <option value="donate">I want to donate</option>
                            <option value="all">All of the above</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="experience">Have you been affected by SAPCR fraud? (optional)</label>
                        <textarea id="experience" name="experience" rows="3" placeholder="Briefly share your experience or leave blank"></textarea>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="legislativeUpdates" name="legislativeUpdates" value="yes" checked>
                        <label for="legislativeUpdates">Send me legislative updates and action alerts</label>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="newsletter" name="newsletter" value="yes" checked>
                        <label for="newsletter">Subscribe to the SAFE SAPCR newsletter</label>
                    </div>

                    <button type="submit" class="btn-submit">Join SAFE SAPCR Texas</button>

                    <p style="text-align: center; margin-top: 1rem; font-size: 0.85rem; color: var(--text-light);">
                        By joining, you agree to receive email updates about SAFE SAPCR advocacy efforts. You can unsubscribe at any time.
                    </p>
                </form>
            </div>

            <!-- Success Message -->
            <div class="success-message" id="successMessage">
                <div class="checkmark">âœ“</div>
                <h2>Welcome to SAFE SAPCR Texas!</h2>
                <p>Thank you for joining our advocacy network. You'll receive a confirmation email shortly with next steps and resources.</p>
                <a href="/legislators" class="btn btn-primary" style="display: inline-block; padding: 1rem 2rem; background: var(--primary); color: white; text-decoration: none; border-radius: 6px; font-weight: 600;">Contact Your Legislator</a>
            </div>
        </div>
    </section>

    <section class="benefits-section">
        <h2>Member Benefits</h2>
        <div class="benefits-grid">
            <div class="benefit-card">
                <h3>Legislative Updates</h3>
                <p>Be the first to know when the SAFE SAPCR Act moves forward in the Texas Legislature. Get alerts on committee hearings and votes.</p>
            </div>
            <div class="benefit-card">
                <h3>Advocacy Resources</h3>
                <p>Access templates, talking points, and guides for contacting your legislators and sharing your story effectively.</p>
            </div>
            <div class="benefit-card">
                <h3>Community Connection</h3>
                <p>Connect with other advocates across Texas who share your passion for protecting families from service fraud.</p>
            </div>
            <div class="benefit-card">
                <h3>Action Alerts</h3>
                <p>Receive timely calls to action when your voice is needed most - during hearings, votes, and key advocacy moments.</p>
            </div>
        </div>
    </section>

    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <picture><source srcset="/images/safe-sapcr-logo.webp" type="image/webp"><img src="/images/safe-sapcr-logo.png" alt="SAFE SAPCR Logo" class="footer-logo-img" width="60" height="60" loading="lazy"></picture>
                <span>SAFE SAPCR<span class="tx">TX</span></span>
            </div>
            <p>Service Accountability and Fraud Elimination of Suits Affecting the Parent-Child Relationship</p>
            <p class="disclaimer">This website presents factual information from public court records and advocates for legislative reform. It is not legal advice.</p>
            <p class="contact">Contact: <a href="mailto:info@safesapcrtx.org">info@safesapcrtx.org</a></p>
            <p class="social-links">Follow us: <a href="https://www.facebook.com/profile.php?id=61585886109488" target="_blank" rel="noopener">Facebook</a></p>
            <p class="copyright">&copy; 2025-2026 SAFE SAPCR Texas. All rights reserved.</p>
        </div>
    </footer>

    <script>
    // Initialize Supabase
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Auth0 client instance
    let auth0Client = null;

    // Initialize Auth0 and handle authentication
    async function initAuth0() {
        try {
            auth0Client = await auth0.createAuth0Client({
                domain: AUTH0_DOMAIN,
                clientId: AUTH0_CLIENT_ID,
                authorizationParams: {
                    redirect_uri: AUTH0_REDIRECT_URI
                },
                cacheLocation: 'localstorage'
            });

            // Check if returning from Auth0 redirect
            if (window.location.search.includes('code=') && window.location.search.includes('state=')) {
                await auth0Client.handleRedirectCallback();
                window.history.replaceState({}, document.title, '/membership');
            }

            // Check if user is authenticated
            const isAuthenticated = await auth0Client.isAuthenticated();
            if (isAuthenticated) {
                const user = await auth0Client.getUser();
                showLoggedInView(user);
                await saveUserToSupabase(user);
            }
        } catch (err) {
            console.error('Auth0 initialization error:', err);
        }
    }

    // Show logged-in view with user info
    function showLoggedInView(user) {
        document.getElementById('signupFormContainer').style.display = 'none';
        document.getElementById('loggedInView').classList.add('show');

        const firstName = user.given_name || user.name?.split(' ')[0] || 'Member';
        const email = user.email || '';

        document.getElementById('userName').textContent = firstName;
        document.getElementById('userEmail').textContent = email;

        // Set avatar
        const avatarEl = document.getElementById('userAvatar');
        const initialsEl = document.getElementById('userInitials');
        if (user.picture) {
            avatarEl.innerHTML = `<img src="${user.picture}" alt="${firstName}">`;
        } else {
            initialsEl.textContent = firstName.charAt(0).toUpperCase();
        }
    }

    // Save SSO user to Supabase
    async function saveUserToSupabase(user) {
        try {
            const memberData = {
                email: user.email,
                first_name: user.given_name || user.name?.split(' ')[0] || '',
                last_name: user.family_name || user.name?.split(' ').slice(1).join(' ') || '',
                auth0_id: user.sub,
                auth_provider: user.sub?.split('|')[0] || 'unknown',
                legislative_updates: true,
                newsletter: true
            };

            // Upsert - insert or update if email exists
            const { error } = await supabase
                .from('members')
                .upsert([memberData], { onConflict: 'email' });

            if (error && error.code !== '23505') {
                console.error('Error saving to Supabase:', error);
            }

            // Track in Google Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'sign_up', {
                    'event_category': 'membership',
                    'event_label': 'sso_' + memberData.auth_provider
                });
            }
        } catch (err) {
            console.error('Error saving user:', err);
        }
    }

    // Login with specific connection
    async function loginWithSSO(connection) {
        if (!auth0Client) {
            console.error('Auth0 not initialized');
            return;
        }
        try {
            await auth0Client.loginWithRedirect({
                authorizationParams: {
                    connection: connection
                }
            });
        } catch (err) {
            console.error('Login error:', err);
        }
    }

    // Logout
    async function logout() {
        if (!auth0Client) return;
        await auth0Client.logout({
            logoutParams: {
                returnTo: window.location.origin + '/membership'
            }
        });
    }

    // Mobile menu toggle
    document.addEventListener('DOMContentLoaded', function() {
        const menuToggle = document.getElementById('menuToggle');
        const navMenu = document.getElementById('navMenu');

        if (menuToggle && navMenu) {
            menuToggle.addEventListener('click', function() {
                menuToggle.classList.toggle('active');
                navMenu.classList.toggle('active');
            });

            document.querySelectorAll('#navMenu a').forEach(link => {
                link.addEventListener('click', function() {
                    menuToggle.classList.remove('active');
                    navMenu.classList.remove('active');
                });
            });
        }

        // Initialize Auth0
        initAuth0();

        // SSO button handlers
        document.getElementById('googleLogin').addEventListener('click', () => loginWithSSO('google-oauth2'));
        document.getElementById('microsoftLogin').addEventListener('click', () => loginWithSSO('windowslive'));
        document.getElementById('appleLogin').addEventListener('click', () => loginWithSSO('apple'));
        document.getElementById('logoutBtn').addEventListener('click', logout);

        // Form submission to Supabase (for email signups)
        const form = document.getElementById('signupForm');
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = form.querySelector('.btn-submit');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Joining...';
            submitBtn.disabled = true;

            const formData = {
                email: document.getElementById('email').value,
                first_name: document.getElementById('firstName').value,
                last_name: document.getElementById('lastName').value,
                phone: document.getElementById('phone').value || null,
                city: document.getElementById('city').value,
                county: document.getElementById('county').value || null,
                involvement: document.getElementById('involvement').value || null,
                experience: document.getElementById('experience').value || null,
                legislative_updates: document.getElementById('legislativeUpdates').checked,
                newsletter: document.getElementById('newsletter').checked
            };

            try {
                const { data, error } = await supabase
                    .from('members')
                    .insert([formData]);

                if (error) {
                    if (error.code === '23505') {
                        alert('This email is already registered. Thank you for your support!');
                    } else {
                        throw error;
                    }
                } else {
                    // Track in Google Analytics
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'sign_up', {
                            'event_category': 'membership',
                            'event_label': formData.involvement || 'general'
                        });
                    }

                    // Send email notification
                    try {
                        await fetch('/.netlify/functions/membership-notify', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(formData)
                        });
                    } catch (emailErr) {
                        console.error('Email notification failed:', emailErr);
                    }

                    // Show success message
                    document.getElementById('signupFormContainer').style.display = 'none';
                    document.getElementById('successMessage').classList.add('show');
                    document.querySelector('.signup-section').scrollIntoView({ behavior: 'smooth' });
                }
            } catch (err) {
                console.error('Error:', err);
                alert('There was an error joining. Please try again.');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });
    });
    </script>
    <script src="/chatbot.js"></script>
</body>
</html>
